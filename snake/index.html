<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Snake ‚Äî Retro</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#05060a; --bg2:#0b0e18; --ink:#e6f7ff; --muted:#7fd0e0; --border:#00f0ff55;
    --neon1:#00f0ff; --neon2:#ff47ff; --card:#0a0d17f0;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;color:var(--ink);
    font-family:'Press Start 2P',system-ui,-apple-system,Segoe UI,Roboto,Arial;
    background:
      radial-gradient(1200px 700px at 20% -10%, #1a0f3a55 0%, transparent 60%),
      radial-gradient(1100px 650px at 110% 10%, #003a4450 0%, transparent 60%),
      linear-gradient(180deg,var(--bg1),var(--bg2));
    letter-spacing:.4px;
  }
  body::before,body::after{content:"";position:fixed;inset:0;pointer-events:none;z-index:0}
  body::before{
    background:repeating-linear-gradient(to bottom,rgba(255,255,255,.06) 0,rgba(255,255,255,.06) 1px,transparent 2px,transparent 4px);
    mix-blend-mode:overlay;
  }
  body::after{background:radial-gradient(1200px 700px at 50% -10%,transparent 40%,rgba(0,0,0,.55) 100%)}
  .wrap{max-width:960px;margin:0 auto;padding:16px;position:relative;z-index:1}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
  h1{margin:0;font-size:clamp(16px,3.6vw,24px);text-shadow:0 0 6px var(--neon1),0 0 12px var(--neon2)}
  .btn{border:2px solid var(--neon2);background:#000;color:#fff;border-radius:6px;padding:8px 12px;cursor:pointer;box-shadow:0 0 12px var(--neon2)}
  .panel{border:2px solid var(--border);background:var(--card);border-radius:14px;padding:12px}
  .grid{display:grid;grid-template-columns:2fr 1fr;gap:12px}
  @media (max-width:900px){.grid{grid-template-columns:1fr}}
  canvas{display:block;width:100%;height:auto;background:#000;border:2px solid var(--border);border-radius:10px;image-rendering:pixelated}
  .stats{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:10px}
  .stat{border:2px solid var(--border);background:#0008;border-radius:10px;padding:10px;text-align:center}
  .label{font-size:10px;color:var(--muted)} .value{font-size:16px}
  .touch{display:grid;grid-template-columns:repeat(3,70px);gap:10px;justify-content:center;margin-top:10px}
  .dpad{width:70px;height:70px;border-radius:8px;background:#000;border:2px solid var(--neon1);display:grid;place-items:center;box-shadow:0 0 10px var(--neon1)}
  .msg{margin-top:8px;color:var(--muted);font-size:10px}

  /* === Legibility upgrades for the right sidebar === */
  .panel.solid{
    background:#0c1224f5;            /* less transparent */
    border-color:#00f0ffaa;           /* brighter border */
    box-shadow:0 0 0 2px #000 inset;
  }
  .sidebar{ 
    color:#eaf8ff;
    font-size:12px;                   /* was 10px */
    line-height:1.75;
    letter-spacing:0.2px;
    text-shadow:0 0 2px #001622;      /* subtle edge crispness */
  }
  .sidebar h3{
    margin:8px 0 10px;
    font-size:14px;                   /* clearer section titles */
    color:#bff2ff;
    text-shadow:0 0 6px #00f0ff;
  }
  .sidebar .stats .stat{
    padding:12px;
    background:#050a18;               /* solid chip bg */
    border-color:#00e6ff99;
  }
  .sidebar .label{ 
    font-size:12px;                   /* was 10px */
    color:#cbefff; 
  }
  .sidebar .value{ 
    font-size:20px;                   /* was 16px */
    color:#ffffff;
    text-shadow:0 0 6px #00f0ff55;
  }
  .sidebar .msg{
    color:#d7f4ff;                    /* brighter helper text */
    font-size:12px;                   /* was 10px */
    line-height:1.7;
  }
  /* Range control: thicker track + neon thumb for readability */
  #speed{ accent-color:#00f0ff; height:8px; }
  #speed::-webkit-slider-thumb{
    width:18px;height:18px;border-radius:4px;
    background:#ff47ff;border:2px solid #fff;box-shadow:0 0 10px #ff47ff;
    margin-top:-5px;
  }
  #speed::-moz-range-thumb{
    width:18px;height:18px;border-radius:4px;
    background:#ff47ff;border:2px solid #fff;box-shadow:0 0 10px #ff47ff;
  }
  /* Make scanlines less intense over the panel content area */
  .panel.solid *{ isolation:isolate; }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>üêç Snake (Retro)</h1>
    <div>
      <a class="btn" href="../">‚Üê Back</a>
      <button id="pauseBtn" class="btn">Pause</button>
      <button id="resetBtn" class="btn">Reset</button>
    </div>
  </header>

  <div class="grid">
    <section class="panel">
      <canvas id="game" width="600" height="600"></canvas>
      <div class="touch" id="touchControls" style="display:none">
        <span></span><button class="dpad" data-d="up">‚ñ≤</button><span></span>
        <button class="dpad" data-d="left">‚óÄ</button><button class="dpad" data-d="down">‚ñº</button><button class="dpad" data-d="right">‚ñ∂</button>
      </div>
      <div class="msg">Keys: Arrow / WASD ‚Ä¢ P pause ‚Ä¢ R restart ‚Ä¢ Mobile: swipe or D-pad</div>
    </section>

    <!-- NOTE: added classes "solid sidebar" for legibility -->
    <aside class="panel solid sidebar">
      <h3 style="margin:6px 0 10px">Stats</h3>
      <div class="stats">
        <div class="stat"><div class="label">Score</div><div id="score" class="value">0</div></div>
        <div class="stat"><div class="label">High</div><div id="best" class="value">0</div></div>
      </div>
      <h3 style="margin:14px 0 10px">Speed</h3>
      <div style="display:flex;align-items:center;gap:10px">
        <input id="speed" type="range" min="5" max="20" value="10" />
        <span id="speedVal" class="label">10</span>
      </div>
      <p class="msg">Apples +1. Every 5 apples, a small speed bump. Don‚Äôt hit walls or yourself!</p>
    </aside>
  </div>
</div>

<script>
const cvs = document.getElementById('game');
const ctx = cvs.getContext('2d');
const scoreEl = document.getElementById('score');
const bestEl = document.getElementById('best');
const speedInput = document.getElementById('speed');
const speedVal = document.getElementById('speedVal');
const pauseBtn = document.getElementById('pauseBtn');
const resetBtn = document.getElementById('resetBtn');

const HS_KEY = 'snake.hs.v1';
let best = +localStorage.getItem(HS_KEY) || 0; bestEl.textContent = best;

const CELLS = 20;
const SIZE = cvs.width / CELLS;

let snake, dir, nextDir, apple, score, tickMs, paused, lastTick, over;

function init(){
  snake = [{x:10,y:10},{x:9,y:10},{x:8,y:10}];
  dir = {x:1,y:0}; nextDir = {...dir};
  apple = spawnApple(); score = 0;
  tickMs = 1000 / (+speedInput.value);
  paused = false; over = false; lastTick = 0;
  draw(); updateStats();
}
function spawnApple(){
  while(true){
    const a={x:Math.floor(Math.random()*CELLS), y:Math.floor(Math.random()*CELLS)};
    if(!snake.some(s=>s.x===a.x && s.y===a.y)) return a;
  }
}
function updateStats(){ scoreEl.textContent = score; bestEl.textContent = best; speedVal.textContent = speedInput.value; }
function step(t){
  if(!lastTick) lastTick = t;
  const dt = t - lastTick;
  if(!paused && !over && dt >= tickMs){
    lastTick = t;
    dir = nextDir;
    const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};
    if(head.x<0 || head.x>=CELLS || head.y<0 || head.y>=CELLS ||
       snake.some(s=>s.x===head.x && s.y===head.y)){
      over = true; if(score > best){ best = score; localStorage.setItem(HS_KEY, best); }
    }else{
      snake.unshift(head);
      if(head.x===apple.x && head.y===apple.y){
        score++; if(score % 5 === 0) tickMs = Math.max(35, tickMs - 5);
        apple = spawnApple();
      }else snake.pop();
    }
    draw(); updateStats();
  }
  requestAnimationFrame(step);
}
function draw(){
  // CRT-ish grid bg
  const g = ctx.createLinearGradient(0,0,cvs.width,cvs.height);
  g.addColorStop(0,'#070a18'); g.addColorStop(1,'#0b1430');
  ctx.fillStyle = g; ctx.fillRect(0,0,cvs.width,cvs.height);
  ctx.strokeStyle = 'rgba(0,240,255,0.15)'; ctx.lineWidth = 1;
  for(let i=1;i<CELLS;i++){
    ctx.beginPath(); ctx.moveTo(i*SIZE,0); ctx.lineTo(i*SIZE,cvs.height); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(0,i*SIZE); ctx.lineTo(cvs.width,i*SIZE); ctx.stroke();
  }
  // apple
  ctx.fillStyle = '#ff47ff';
  fillPixel(apple.x, apple.y);
  // snake
  snake.forEach((s,i)=>{ ctx.fillStyle = i===0? '#e6f7ff':'#00f0ff'; fillPixel(s.x,s.y); });
  if(paused || over){
    ctx.fillStyle = 'rgba(0,0,0,.45)'; ctx.fillRect(0,0,cvs.width,cvs.height);
    ctx.fillStyle = '#e6f7ff'; ctx.textAlign='center';
    ctx.font = 'bold 28px "Press Start 2P"'; ctx.fillText(over?'GAME OVER':'PAUSED', cvs.width/2, cvs.height/2 - 8);
    ctx.font = '12px "Press Start 2P"'; ctx.fillText('R to restart', cvs.width/2, cvs.height/2 + 22);
  }
}
function fillPixel(cx,cy){
  const pad = 2;
  ctx.fillRect(cx*SIZE+pad, cy*SIZE+pad, SIZE-pad*2, SIZE-pad*2);
}

function setDir(nx,ny){ if(nx === -dir.x && ny === -dir.y) return; nextDir = {x:nx, y:ny}; }
window.addEventListener('keydown', e=>{
  const k = e.key.toLowerCase();
  if(k==='arrowup' || k==='w') setDir(0,-1);
  if(k==='arrowdown' || k==='s') setDir(0,1);
  if(k==='arrowleft' || k==='a') setDir(-1,0);
  if(k==='arrowright' || k==='d') setDir(1,0);
  if(k==='p') paused = !paused;
  if(k==='r') init();
});
pauseBtn.onclick = ()=> paused = !paused;
resetBtn.onclick = ()=> init();

const touchControls = document.getElementById('touchControls');
function isTouch(){ return 'ontouchstart' in window || navigator.maxTouchPoints>0; }
if(isTouch()) touchControls.style.display = 'grid';
let touchStart=null;
cvs.addEventListener('touchstart', e=>{touchStart = e.touches[0];},{passive:true});
cvs.addEventListener('touchmove', e=>{
  if(!touchStart) return;
  const dx = e.touches[0].clientX - touchStart.clientX;
  const dy = e.touches[0].clientY - touchStart.clientY;
  if(Math.abs(dx)+Math.abs(dy) > 24){
    if(Math.abs(dx) > Math.abs(dy)) setDir(dx>0?1:-1,0);
    else setDir(0,dy>0?1:-1);
    touchStart=null;
  }
},{passive:true});
document.querySelectorAll('.dpad').forEach(b=>{
  b.addEventListener('click', ()=>{
    const d=b.dataset.d;
    if(d==='up') setDir(0,-1);
    if(d==='down') setDir(0,1);
    if(d==='left') setDir(-1,0);
    if(d==='right') setDir(1,0);
  });
});
function fit(){ const s = Math.min(cvs.parentElement.clientWidth, 600); cvs.style.width = s+'px'; cvs.style.height = s+'px'; }
window.addEventListener('resize', fit);
speedInput.addEventListener('input', ()=>{ speedVal.textContent = speedInput.value; tickMs = 1000 / (+speedInput.value); });

init(); fit(); requestAnimationFrame(step);
</script>
</body>
</html>
