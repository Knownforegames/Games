<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Snake</title>
<style>
  :root{--bg:#0b1020;--panel:#101927;--ink:#e5e7eb;--muted:#9ca3af;--accent:#22d3ee;--accent2:#a78bfa;}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:
    radial-gradient(900px 500px at 100% -10%, rgba(34,211,238,.12), transparent),
    radial-gradient(800px 400px at -20% 20%, rgba(167,139,250,.12), transparent),
    linear-gradient(180deg,#0b1020,#0e162b);
    color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .wrap{max-width:900px;margin:0 auto;padding:16px}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
  h1{margin:0;font-size:clamp(22px,4vw,30px)}
  .btn{padding:8px 12px;border:1px solid #ffffff22;border-radius:10px;background:#ffffff12;color:#fff;cursor:pointer;font-weight:700}
  .panel{border:1px solid #ffffff22;background:#111827cc;border-radius:16px;padding:12px}
  .grid{display:grid;grid-template-columns:2fr 1fr;gap:12px}
  @media (max-width:900px){.grid{grid-template-columns:1fr}}
  .stats{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
  .stat{background:#ffffff0a;border:1px solid #ffffff22;border-radius:10px;padding:10px}
  .label{color:var(--muted);font-size:12px}
  .value{font-weight:800;font-size:20px}
  canvas{display:block;width:100%;height:auto;background:#0a1222;border-radius:12px;border:1px solid #ffffff22}
  .touch{display:grid;grid-template-columns:repeat(3,70px);gap:10px;justify-content:center;margin-top:10px}
  .dpad{width:70px;height:70px;border-radius:12px;background:#ffffff10;border:1px solid #ffffff22;display:grid;place-items:center;font-weight:800}
  .msg{margin-top:8px;color:var(--muted);font-size:14px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>üêç Snake</h1>
    <div>
      <a class="btn" href="../">‚Üê Back to GameDock</a>
      <button id="pauseBtn" class="btn">Pause</button>
      <button id="resetBtn" class="btn">Reset</button>
    </div>
  </header>

  <div class="grid">
    <section class="panel">
      <canvas id="game" width="600" height="600"></canvas>
      <!-- Mobile controls -->
      <div class="touch" id="touchControls" style="display:none">
        <span></span><button class="dpad" data-d="up">‚ñ≤</button><span></span>
        <button class="dpad" data-d="left">‚óÄ</button><button class="dpad" data-d="down">‚ñº</button><button class="dpad" data-d="right">‚ñ∂</button>
      </div>
      <div class="msg">Controls: Arrow keys / WASD. Mobile: swipe or use the on-screen pad. P = pause, R = restart.</div>
    </section>

    <aside class="panel">
      <h3 style="margin:6px 0 10px">Stats</h3>
      <div class="stats">
        <div class="stat"><div class="label">Score</div><div id="score" class="value">0</div></div>
        <div class="stat"><div class="label">High Score</div><div id="best" class="value">0</div></div>
      </div>
      <h3 style="margin:14px 0 10px">Settings</h3>
      <div style="display:flex;align-items:center;gap:10px">
        <label class="label">Speed</label>
        <input id="speed" type="range" min="5" max="20" value="10" />
        <span id="speedVal" class="label">10</span>
      </div>
      <p class="msg">Apples give +1. Every 5 apples, speed increases slightly. Don‚Äôt hit walls or yourself!</p>
    </aside>
  </div>
</div>

<script>
const cvs = document.getElementById('game');
const ctx = cvs.getContext('2d');
const scoreEl = document.getElementById('score');
const bestEl = document.getElementById('best');
const speedInput = document.getElementById('speed');
const speedVal = document.getElementById('speedVal');
const pauseBtn = document.getElementById('pauseBtn');
const resetBtn = document.getElementById('resetBtn');

const HS_KEY = 'snake.hs.v1';
let best = +localStorage.getItem(HS_KEY) || 0;
bestEl.textContent = best;

// Grid
const CELLS = 20;                // 20x20 grid
const SIZE = cvs.width / CELLS;  // cell size in px

// Game state
let snake, dir, nextDir, apple, score, tickMs, paused, lastTick, over;

function init(){
  snake = [{x:10,y:10},{x:9,y:10},{x:8,y:10}];
  dir = {x:1,y:0};
  nextDir = {...dir};
  apple = spawnApple();
  score = 0;
  tickMs = 1000 / (+speedInput.value); // base speed from slider
  paused = false;
  over = false;
  lastTick = 0;
  draw(); updateStats();
}
function spawnApple(){
  while(true){
    const a={x:Math.floor(Math.random()*CELLS), y:Math.floor(Math.random()*CELLS)};
    if(!snake.some(s=>s.x===a.x && s.y===a.y)) return a;
  }
}
function updateStats(){
  scoreEl.textContent = score;
  bestEl.textContent = best;
  speedVal.textContent = speedInput.value;
}
function step(t){
  if(!lastTick) lastTick = t;
  const dt = t - lastTick;
  if(!paused && !over && dt >= tickMs){
    lastTick = t;
    // apply nextDir
    dir = nextDir;

    const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};
    // collisions
    if(head.x<0 || head.x>=CELLS || head.y<0 || head.y>=CELLS ||
       snake.some(s=>s.x===head.x && s.y===head.y)){
      over = true;
      if(score > best){ best = score; localStorage.setItem(HS_KEY, best); }
    }else{
      snake.unshift(head);
      if(head.x===apple.x && head.y===apple.y){
        score++;
        if(score % 5 === 0) tickMs = Math.max(35, tickMs - 5); // speed up a bit
        apple = spawnApple();
      }else{
        snake.pop();
      }
    }
    draw(); updateStats();
  }
  requestAnimationFrame(step);
}

// Draw
function draw(){
  // background
  const g = ctx.createLinearGradient(0,0,cvs.width,cvs.height);
  g.addColorStop(0,'#0b1224');
  g.addColorStop(1,'#0e1a34');
  ctx.fillStyle = g;
  ctx.fillRect(0,0,cvs.width,cvs.height);

  // grid lines (subtle)
  ctx.strokeStyle = 'rgba(255,255,255,0.07)';
  ctx.lineWidth = 1;
  for(let i=1;i<CELLS;i++){
    ctx.beginPath(); ctx.moveTo(i*SIZE,0); ctx.lineTo(i*SIZE,cvs.height); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(0,i*SIZE); ctx.lineTo(cvs.width,i*SIZE); ctx.stroke();
  }

  // apple
  const ax = apple.x*SIZE, ay = apple.y*SIZE;
  const ag = ctx.createRadialGradient(ax+SIZE*0.35, ay+SIZE*0.35, 2, ax+SIZE*0.5, ay+SIZE*0.5, SIZE*0.7);
  ag.addColorStop(0,'#fff');
  ag.addColorStop(1,'#f472b6');
  ctx.fillStyle = ag;
  roundRect(ax+3, ay+3, SIZE-6, SIZE-6, 6);

  // snake
  for(let i=0;i<snake.length;i++){
    const s = snake[i];
    const x = s.x*SIZE, y = s.y*SIZE;
    const sg = ctx.createLinearGradient(x,y,x+SIZE,y+SIZE);
    sg.addColorStop(0,'#22d3ee');
    sg.addColorStop(1,'#a78bfa');
    ctx.fillStyle = i===0 ? '#b8f3ff' : sg;
    roundRect(x+2, y+2, SIZE-4, SIZE-4, 6);
  }

  // overlay
  if(paused || over){
    ctx.fillStyle = 'rgba(0,0,0,0.45)';
    ctx.fillRect(0,0,cvs.width,cvs.height);
    ctx.fillStyle = '#e5e7eb';
    ctx.font = 'bold 36px system-ui, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(over ? 'Game Over' : 'Paused', cvs.width/2, cvs.height/2 - 10);
    ctx.font = '16px system-ui, sans-serif';
    ctx.fillText('Press R to restart', cvs.width/2, cvs.height/2 + 20);
  }
}
function roundRect(x,y,w,h,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
  ctx.fill();
}

// Input
function setDir(nx,ny){
  // prevent reversing directly
  if(nx === -dir.x && ny === -dir.y) return;
  nextDir = {x:nx, y:ny};
}
window.addEventListener('keydown', e=>{
  const k = e.key.toLowerCase();
  if(k==='arrowup' || k==='w') setDir(0,-1);
  if(k==='arrowdown' || k==='s') setDir(0,1);
  if(k==='arrowleft' || k==='a') setDir(-1,0);
  if(k==='arrowright' || k==='d') setDir(1,0);
  if(k==='p') togglePause();
  if(k==='r') init();
});
pauseBtn.onclick = togglePause;
resetBtn.onclick = init;
function togglePause(){ paused = !paused; draw(); }

// Touch / swipe
const touchControls = document.getElementById('touchControls');
function isTouch(){ return 'ontouchstart' in window || navigator.maxTouchPoints>0; }
if(isTouch()) touchControls.style.display = 'grid';
let touchStart=null;
cvs.addEventListener('touchstart', e=>{touchStart = e.touches[0];}, {passive:true});
cvs.addEventListener('touchmove', e=>{
  if(!touchStart) return;
  const dx = e.touches[0].clientX - touchStart.clientX;
  const dy = e.touches[0].clientY - touchStart.clientY;
  if(Math.abs(dx)+Math.abs(dy) > 24){
    if(Math.abs(dx) > Math.abs(dy)) setDir(dx>0?1:-1,0);
    else setDir(0,dy>0?1:-1);
    touchStart=null;
  }
},{passive:true});
document.querySelectorAll('.dpad').forEach(b=>{
  b.addEventListener('click', ()=>{
    const d=b.dataset.d;
    if(d==='up') setDir(0,-1);
    if(d==='down') setDir(0,1);
    if(d==='left') setDir(-1,0);
    if(d==='right') setDir(1,0);
  });
});

// Resize canvas to be square but responsive
function fit(){
  const s = Math.min(cvs.parentElement.clientWidth, 600);
  cvs.style.width = s+'px';
  cvs.style.height = s+'px';
}
window.addEventListener('resize', fit);

// Start
speedInput.addEventListener('input', ()=>{ speedVal.textContent = speedInput.value; tickMs = 1000 / (+speedInput.value); });
init(); fit(); requestAnimationFrame(step);
</script>
</body>
</html>
