<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pixel Racer (Retro)</title>
  <style>
    :root{
      --c0:#0ff; --c1:#0af; --bg:#0a0f14; --panel:#0d1a22; --line:#0ff8;
      --txt:#e7faff; --accent:#ff8bf3; --glow:0 0 16px #0ff6,0 0 32px #0ff3;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--txt); font-family: 'Press Start 2P', system-ui, sans-serif;
      background: radial-gradient(1200px 700px at 25% 10%, #112a55, #0a0f14 60%),
                  radial-gradient(1200px 600px at 60% 105%, #083045, #0a0f14 60%),
                  linear-gradient(0deg, #0b0f16, #0a0f14);
      letter-spacing:.4px;
    }
    .wrap{max-width:980px;margin:24px auto;padding:12px;}
    .hud{display:flex;align-items:center;gap:12px;margin-bottom:10px}
    h1{margin:0;font-size:28px;text-shadow: var(--glow)}
    .btn{
      padding:10px 14px;border:2px solid var(--line);border-radius:12px;background:#151b22;
      color:#fff; cursor:pointer; box-shadow: var(--glow); font-size:12px;
    }
    .layout{display:grid;grid-template-columns:2fr 1fr;gap:14px}
    .panel{border:2px solid var(--line);border-radius:14px;padding:10px;background:#0b141a}
    canvas{display:block;width:100%;height:100%;border-radius:10px}
    .gamebox{height:70vh;min-height:480px;display:flex}
    .gamebox canvas{flex:1}
    .stat{display:flex;justify-content:space-between;padding:8px;border:1px solid var(--line);border-radius:8px;margin-top:8px}
    .foot{font-size:12px;opacity:.8;margin-top:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hud">
      <h1>üëæ Pixel Racer (Retro)</h1>
      <button class="btn" id="btnBack">‚Üê Back</button>
      <button class="btn" id="btnPause">Pause</button>
      <button class="btn" id="btnReset">Reset</button>
    </div>

    <div class="layout">
      <div class="panel gamebox">
        <canvas id="game" width="480" height="720" aria-label="Pixel Racer canvas"></canvas>
      </div>
      <div class="panel">
        <h3 style="margin:6px 0 8px">Stats</h3>
        <div class="stat"><span>Score</span><strong id="score">0</strong></div>
        <div class="stat"><span>Best</span><strong id="best">0</strong></div>
        <div class="stat"><span>Coins</span><strong id="coins">0</strong></div>
        <p class="foot">Keys: A/D lanes ‚Ä¢ Hold SHIFT for turbo ‚Ä¢ P pause ‚Ä¢ R reset</p>
      </div>
    </div>
  </div>

  <script>
  // ===== Safe-boot error overlay (shows errors on-screen) =====
  window.onerror = (m,s,l,c,e)=>{
    const d=document.createElement('div');
    d.style.cssText='position:fixed;top:8px;left:8px;background:#300;color:#fff;padding:8px;z-index:9999;border:1px solid #f66;font:12px monospace';
    d.textContent='JS Error: '+m+' @'+s+':'+l; document.body.appendChild(d);
  };
  window.addEventListener('unhandledrejection',ev=>{
    const d=document.createElement('div');
    d.style.cssText='position:fixed;top:48px;left:8px;background:#303;color:#fff;padding:8px;z-index:9999;border:1px solid #6f6;font:12px monospace';
    d.textContent='Promise Rejection: '+ev.reason; document.body.appendChild(d);
  });

  // ===== Minimal working game loop =====
  (function(){
    const cvs = document.getElementById('game');
    const ctx = cvs.getContext('2d');

    // Fit canvas to container while preserving internal resolution
    function fit(){
      const box = cvs.parentElement.getBoundingClientRect();
      // keep 2:3 ratio
      const targetW = Math.min(box.width, 520);
      const targetH = targetW*1.5;
      cvs.style.width = targetW+'px';
      cvs.style.height = targetH+'px';
    }
    addEventListener('resize', fit); fit();

    const lanes = [cvs.width*0.25, cvs.width*0.5, cvs.width*0.75];
    let player = {x: lanes[1], y: cvs.height-120, lane:1, w:36, h:60, vx:0};
    let t=0, running=true, score=0, best=+localStorage.pixelRacerBest||0;
    let speed=4, dotted=0, obstacles=[];
    const keys = new Set();

    function reset(){
      obstacles.length=0; score=0; speed=4; player.lane=1; player.x=lanes[1]; player.vx=0; t=0; running=true;
    }

    function spawn(){
      const lane = Math.floor(Math.random()*3);
      obstacles.push({x: lanes[lane], y: -70, w:36, h:60, lane});
    }

    function drawCar(x,y,w,h,color){
      ctx.fillStyle=color;
      ctx.fillRect(x-w/2, y-h/2, w, h);
      ctx.fillStyle="#0006";
      ctx.fillRect(x-w/2+6, y-h/2+8, w-12, h-16);
    }

    function loop(){
      if(!running){ requestAnimationFrame(loop); return; }
      t+=1;
      // background
      ctx.fillStyle='#000'; ctx.fillRect(0,0,cvs.width,cvs.height);
      // road
      ctx.fillStyle='#111c26'; ctx.fillRect(40,0,cvs.width-80,cvs.height);
      // lane markers
      ctx.fillStyle='#9ff';
      ctx.setLineDash([20,20]); ctx.lineDashOffset = dotted; dotted-=6;
      ctx.lineWidth=4; ctx.beginPath();
      ctx.moveTo(cvs.width/2,0); ctx.lineTo(cvs.width/2,cvs.height);
      ctx.moveTo( (cvs.width/2+40),0); ctx.lineTo( (cvs.width/2+40),cvs.height);
      ctx.moveTo( (cvs.width/2-40),0); ctx.lineTo( (cvs.width/2-40),cvs.height);
      ctx.stroke();

      // input
      if(keys.has('KeyA')||keys.has('ArrowLeft')) player.lane=Math.max(0, player.lane-(t%6===0));
      if(keys.has('KeyD')||keys.has('ArrowRight')) player.lane=Math.min(2, player.lane+(t%6===0));
      const targetX = lanes[player.lane];
      player.x += (targetX - player.x)*0.2;

      // obstacles
      if(t%55===0) spawn();
      for(const o of obstacles){ o.y += speed + (score/500); }
      while(obstacles.length && obstacles[0].y>cvs.height+80){ obstacles.shift(); score+=10; }

      // collisions
      for(const o of obstacles){
        if(Math.abs(o.x-player.x)<(o.w+player.w)/2 && Math.abs(o.y-player.y)<(o.h+player.h)/2){
          running=false;
          best=Math.max(best,score); localStorage.pixelRacerBest=best;
        }
      }

      // draw obstacles & player
      for(const o of obstacles) drawCar(o.x,o.y,o.w,o.h,'#ffcf5a');
      drawCar(player.x, player.y, player.w, player.h, running?'#66e6ff':'#ff6ea8');

      // UI
      document.getElementById('score').textContent = score;
      document.getElementById('best').textContent = best;

      requestAnimationFrame(loop);
    }

    // controls
    addEventListener('keydown',e=>{
      if(e.code==='KeyP'){running=!running; return;}
      if(e.code==='KeyR'){reset(); return;}
      keys.add(e.code);
    });
    addEventListener('keyup',e=>keys.delete(e.code));
    document.getElementById('btnPause').onclick=()=>running=!running;
    document.getElementById('btnReset').onclick=reset;
    document.getElementById('btnBack').onclick=()=>history.back();

    // start!
    reset(); requestAnimationFrame(loop);
  })();
  </script>
</body>
</html>
